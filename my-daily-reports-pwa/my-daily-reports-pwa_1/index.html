<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#111111">
<title>My Daily Reports</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- =============== AUTH =============== -->
<div id="authView" class="auth-screen">
  <div class="auth-logo">My Daily Reports</div>
  <div class="auth-sub">Construction Inspection Management</div>
  <div class="auth-card">
    <div class="auth-tabs">
      <div class="auth-tab active" onclick="Auth.tabSwitch('login')">Sign In</div>
      <div class="auth-tab" onclick="Auth.tabSwitch('signup')">Sign Up</div>
    </div>
    <button class="google-btn" onclick="Auth.google()">
      <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
      Continue with Google
    </button>
    <div class="auth-divider">or</div>
    <!-- Login -->
    <div id="authLoginForm">
      <label class="field-label">Email</label>
      <input type="email" id="authEmail" class="field-input" placeholder="you@example.com">
      <label class="field-label">Password</label>
      <input type="password" id="authPassword" class="field-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <button class="btn-primary" onclick="Auth.emailLogin()" id="authSubmitBtn">Sign In</button>
    </div>
    <!-- Signup -->
    <div id="authSignupForm" class="hidden">
      <label class="field-label">Full Name</label>
      <input type="text" id="signupName" class="field-input" placeholder="Your name">
      <label class="field-label">Email</label>
      <input type="email" id="signupEmail" class="field-input" placeholder="you@example.com">
      <label class="field-label">Password</label>
      <input type="password" id="signupPassword" class="field-input" placeholder="Min 6 characters">
      <button class="btn-primary" onclick="Auth.emailSignup()">Create Account</button>
    </div>
    <div id="authError"></div>
  </div>
  <div style="margin-top:24px;text-align:center">
    <button class="btn-secondary" onclick="showSetupModal()" style="font-size:12px">Configure Supabase</button>
  </div>
</div>

<!-- =============== APP =============== -->
<div id="appView" class="hidden">
<div class="app-container">

  <div class="app-header">
    <div><div class="app-header-title">My Daily Reports</div><div class="app-header-sub" id="headerUserName"></div></div>
    <div class="app-header-right"><button class="header-btn" onclick="nav('settings')">‚öôÔ∏è</button></div>
  </div>

  <!-- HOME -->
  <div id="page-home" class="page">
    <div style="padding:12px 16px;display:flex;align-items:center;justify-content:space-between">
      <h2 style="font-size:20px">Jobs</h2>
      <button class="btn-secondary" onclick="nav('create-job')">+ New Job</button>
    </div>
    <div class="card" style="margin-top:0"><div id="jobsList"></div></div>
    <div id="archivedSection" class="hidden" style="padding:0 16px">
      <details class="collapse" style="border-top:none">
        <summary class="collapse-hdr">Archived Jobs</summary>
        <div id="archivedJobsList" class="card" style="margin:8px 0"></div>
      </details>
    </div>
  </div>

  <!-- CREATE/EDIT JOB -->
  <div id="page-create-job" class="page hidden">
    <div class="back-row" onclick="nav('home')">‚Üê Jobs</div>
    <div class="card"><div class="card-header"><h3 id="jobFormTitle">New Job</h3></div>
    <div class="card-body">
      <input type="hidden" id="editJobId">
      <label class="field-label">Job Name *</label><input type="text" id="jobName" class="field-input" placeholder="e.g., Woodland Park Middle School">
      <label class="field-label">Site Address</label><input type="text" id="jobAddress" class="field-input" placeholder="123 Main St, City, CA">
      <label class="field-label">Hours Budget</label><input type="number" id="jobHoursBudget" class="field-input">
      <label class="field-label">Report Filename Pattern</label><input type="text" id="jobFilenamePattern" class="field-input">
      <label class="field-label">Export Destination</label><input type="text" id="jobExportDest" class="field-input">
      <label class="field-label">PDF Template Path</label><input type="text" id="jobTemplatePath" class="field-input">
      <button class="btn-primary" onclick="Jobs.save()" id="saveJobBtn">Create Job</button>
      <div id="deleteJobSection" class="hidden" style="margin-top:12px"><button class="btn-danger" onclick="Jobs.archive()" style="width:100%">Archive Job</button></div>
    </div></div>
  </div>

  <!-- JOB DETAIL -->
  <div id="page-job-detail" class="page hidden">
    <div class="back-row" onclick="nav('home')">‚Üê Jobs</div>
    <div style="padding:0 16px 8px;display:flex;align-items:center;justify-content:space-between">
      <div><h2 id="jobDetailName" style="font-size:20px"></h2><div id="jobDetailAddr" style="font-size:13px;color:var(--text-sec)"></div></div>
      <button class="btn-secondary" onclick="Jobs.edit()" style="font-size:11px;padding:6px 12px">Edit</button>
    </div>
    <div class="tabs" id="jobTabBar">
      <div class="tab active" onclick="Jobs.switchTab('reports')">Reports</div>
      <div class="tab" onclick="Jobs.switchTab('schedule')">Schedule</div>
    </div>

    <!-- Reports tab -->
    <div id="jobReportsTab">
      <div style="padding:12px 16px;display:flex;justify-content:flex-end"><button class="btn-secondary" onclick="Reports.startNew()">+ New Report</button></div>
      <div class="card" style="margin-top:0"><div id="reportsList"></div></div>
    </div>

    <!-- Schedule tab -->
    <div id="jobScheduleTab" class="hidden">
      <div class="tabs" style="margin:0 16px">
        <div class="tab active" onclick="Schedule.subTab('calendar')">Calendar</div>
        <div class="tab" onclick="Schedule.subTab('request')">New Request</div>
      </div>

      <!-- Calendar -->
      <div id="schedCalView">
        <div class="card" style="border-radius:0;margin-top:0">
          <div class="cal-nav">
            <button onclick="Schedule.changeMonth(-1)">‚Üê</button>
            <strong id="schedMonthLabel"></strong>
            <button onclick="Schedule.changeMonth(1)">‚Üí</button>
          </div>
          <div class="week-row" style="padding:0 8px"><div class="week-hdr">S</div><div class="week-hdr">M</div><div class="week-hdr">T</div><div class="week-hdr">W</div><div class="week-hdr">T</div><div class="week-hdr">F</div><div class="week-hdr">S</div></div>
          <div id="schedCalGrid" class="week-row" style="padding:0 8px"></div>
          <div class="day-detail" id="schedDayDetail"><div class="day-detail-hdr" id="schedDayHdr"></div><div id="schedDayList"></div></div>
        </div>
      </div>

      <!-- Request form -->
      <div id="schedReqView" class="hidden">
        <div class="card" style="margin-top:0;border-radius:0"><div class="card-body">
          <label class="field-label">Photos or PDFs</label>
          <div class="photo-box" onclick="$('schedFileInput').click()">üì∑ Tap to select photos or PDFs</div>
          <input type="file" id="schedFileInput" onchange="Schedule.handleFiles(this)" multiple style="display:none" accept="image/*,application/pdf">
          <div id="schedFileGrid" class="file-grid"></div>

          <label class="field-label">Inspection Date *</label><input type="date" id="schedDate" class="field-input">
          <label class="field-label">Inspection Time *</label>
          <select id="schedTime" class="field-input">
            <option value="">Select time</option><option value="flexible">Flexible ‚Äî anytime today</option>
            <option value="05:00">5:00 AM</option><option value="05:30">5:30 AM</option><option value="06:00">6:00 AM</option><option value="06:30">6:30 AM</option>
            <option value="07:00">7:00 AM</option><option value="07:30">7:30 AM</option><option value="08:00">8:00 AM</option><option value="08:30">8:30 AM</option>
            <option value="09:00">9:00 AM</option><option value="09:30">9:30 AM</option><option value="10:00">10:00 AM</option><option value="10:30">10:30 AM</option>
            <option value="11:00">11:00 AM</option><option value="11:30">11:30 AM</option><option value="12:00">12:00 PM</option><option value="12:30">12:30 PM</option>
            <option value="13:00">1:00 PM</option><option value="13:30">1:30 PM</option><option value="14:00">2:00 PM</option><option value="14:30">2:30 PM</option>
            <option value="15:00">3:00 PM</option><option value="15:30">3:30 PM</option><option value="16:00">4:00 PM</option><option value="16:30">4:30 PM</option>
            <option value="17:00">5:00 PM</option>
          </select>

          <label class="field-label">Inspection Request # or Summary</label><input type="text" id="schedIdentifier" class="field-input" placeholder="e.g., FDN-003" maxlength="50">

          <label class="field-label">Duration *</label>
          <div class="dur-btns" id="schedDurBtns">
            <div class="dur-btn" onclick="Schedule.setDur('30',this)">30 min</div>
            <div class="dur-btn" onclick="Schedule.setDur('60',this)">1 hr</div>
            <div class="dur-btn" onclick="Schedule.setDur('120',this)">2 hr</div>
            <div class="dur-btn" onclick="Schedule.setDur('240',this)">4 hr</div>
            <div class="dur-btn" onclick="Schedule.setDur('480',this)">All Day</div>
          </div>

          <label class="field-label">Inspection Type *</label>
          <div class="type-btns">
            <div class="type-btn" onclick="Schedule.setType('Special',this)">Special</div>
            <div class="type-btn" onclick="Schedule.setType('IOR',this)">IOR</div>
          </div>
          <div class="special-sub" id="schedSpecialSub">
            <label class="field-label">Special Inspection Type *</label>
            <select class="field-input" id="schedSpecialType">
              <option value="">Select type</option><option>Soils</option><option>Material ID</option>
              <option>Material ID CWI</option><option>Concrete</option><option>Bolting</option>
              <option>Pull Test</option><option>Shotcrete</option><option>Fireproofing</option>
            </select>
          </div>

          <label class="field-label">Submitted By *</label>
          <select id="schedSubmittedBy" class="field-input"><option value="">Select your name</option><option value="other">-- Add name below --</option></select>

          <label class="field-label">Notes</label><textarea id="schedNotes" class="field-input" rows="3" placeholder="Optional details"></textarea>

          <label class="field-label">Send a copy to:</label>
          <div class="email-list" id="schedEmailList"><div style="color:var(--text-mut);font-size:12px;padding:4px 0">Configure team in job settings</div></div>

          <details class="collapse"><summary class="collapse-hdr">Additional Email Recipients</summary>
            <div style="padding-bottom:10px"><input type="text" id="schedAdditionalEmails" class="field-input" placeholder="Emails separated by commas"></div>
          </details>

          <details class="collapse"><summary class="collapse-hdr">Add a New Person</summary>
            <div style="padding:16px;background:#2a2a2a;border-radius:8px;border-left:4px solid var(--blue)">
              <label class="field-label">Name</label><input type="text" id="schedNewName" class="field-input">
              <label class="field-label">Email</label><input type="email" id="schedNewEmail" class="field-input">
              <label class="field-label">Company/Role</label><input type="text" id="schedNewCompany" class="field-input" placeholder="e.g., (CW Driver)">
            </div>
          </details>

          <button class="btn-primary" onclick="Schedule.submitRequest()" id="schedSubmitBtn">Submit Inspection Request</button>
        </div></div>
      </div>
    </div>
  </div>

  <!-- CREATE/EDIT REPORT -->
  <div id="page-create-report" class="page hidden">
    <div class="back-row" onclick="Reports.back()">‚Üê Back</div>
    <div style="padding:0 16px 8px"><h2 id="rptFormTitle" style="font-size:18px">New Report</h2><div id="rptFormJobName" style="font-size:13px;color:var(--text-sec)"></div></div>
    <div class="card" style="margin-top:0">
      <div class="form-sect"><div class="form-sect-title">Report Info</div>
        <input type="hidden" id="rptId"><input type="hidden" id="rptJobId">
        <label class="field-label">Date *</label><input type="date" id="rptDate" class="field-input">
        <label class="field-label">Report Number</label><input type="number" id="rptNumber" class="field-input" value="1" min="1">
      </div>
      <div class="form-sect"><div class="form-sect-title">Project Information</div>
        <label class="field-label">Project Name</label><input type="text" id="rptProjectName" class="field-input">
        <label class="field-label">TYR Project #</label><input type="text" id="rptProjectNumber" class="field-input">
        <label class="field-label">District Name</label><input type="text" id="rptJurisdiction" class="field-input">
        <label class="field-label">DSA Number</label><input type="text" id="rptDsaFileNumber" class="field-input">
        <label class="field-label">Project Address</label><input type="text" id="rptProjectAddress" class="field-input">
        <label class="field-label">Weather</label><input type="text" id="rptWeather" class="field-input">
      </div>
      <div class="form-sect"><div class="form-sect-title">Hours Tracking</div>
        <label class="field-label">Regular Hours</label><input type="text" id="rptRegularHours" class="field-input">
        <label class="field-label">Overtime Hours</label><input type="text" id="rptOvertimeHours" class="field-input">
        <label class="field-label">Double Time Hours</label><input type="text" id="rptDoubleTimeHours" class="field-input">
      </div>
      <div class="form-sect"><div class="form-sect-title">Team Information</div>
        <label class="field-label">Inspector Name (IOR)</label><input type="text" id="rptIorName" class="field-input">
        <label class="field-label">Project Manager</label><input type="text" id="rptProjectManager" class="field-input">
        <label class="field-label">Architect</label><input type="text" id="rptArchitect" class="field-input">
        <label class="field-label">Contractor Names</label><input type="text" id="rptContractor" class="field-input">
      </div>
      <div class="form-sect"><div class="form-sect-title">Contractor Activity</div>
        <label class="field-label">Manpower</label><textarea id="rptManpower" class="field-input" rows="2"></textarea>
        <label class="field-label">Equipment</label><textarea id="rptEquipment" class="field-input" rows="2"></textarea>
        <label class="field-label">Trade</label><input type="text" id="rptTrade" class="field-input">
      </div>
      <div class="form-sect"><div class="form-sect-title">Inspection Content</div>
        <label class="field-label">General Notes</label><textarea id="rptGeneralNotes" class="field-input" rows="4"></textarea>
        <label class="field-label">Inspection and Onsite Activities</label><textarea id="rptInspectionActivities" class="field-input" rows="4"></textarea>
        <label class="field-label">Corrections</label><textarea id="rptCorrections" class="field-input" rows="3"></textarea>
        <label class="field-label">Observation Letters Issued</label><textarea id="rptObservationLetters" class="field-input" rows="2"></textarea>
        <label class="field-label">Notes and Comments</label><textarea id="rptIorNotes" class="field-input" rows="3"></textarea>
      </div>
      <div class="form-sect"><div class="form-sect-title">Inspection Requests</div>
        <label class="field-label">RFIs</label><textarea id="rptRfis" class="field-input" rows="2"></textarea>
        <label class="field-label">Submittals</label><textarea id="rptSubmittals" class="field-input" rows="2"></textarea>
        <label class="field-label">CCDs</label><textarea id="rptCcds" class="field-input" rows="2"></textarea>
        <label class="field-label">ASIs</label><textarea id="rptAsis" class="field-input" rows="2"></textarea>
        <label class="field-label">Site Visits</label><textarea id="rptSiteVisits" class="field-input" rows="2"></textarea>
      </div>
      <div class="form-sect"><div class="form-sect-title">Site Photos</div>
        <div class="photo-box" onclick="$('rptPhotoInput').click()">üì∑ Tap to add site photos</div>
        <input type="file" id="rptPhotoInput" onchange="Reports.handlePhotos(this)" multiple accept="image/*" style="display:none">
        <div id="rptPhotoGrid" class="file-grid"></div>
      </div>
      <div class="form-sect" style="display:flex;gap:10px;flex-direction:column">
        <button class="btn-primary" onclick="Reports.saveDraft()">Save Draft</button>
        <button class="btn-primary" onclick="Reports.submit()" style="background:var(--success)">Submit Report</button>
        <div id="deleteRptSection" class="hidden"><button class="btn-danger" onclick="Reports.deleteCurrent()" style="width:100%">Delete Report</button></div>
      </div>
    </div>
  </div>

  <!-- VIEW REPORT -->
  <div id="page-view-report" class="page hidden">
    <div class="back-row" onclick="Reports.back()">‚Üê Back</div>
    <div id="viewRptContent"></div>
  </div>

  <!-- SETTINGS -->
  <div id="page-settings" class="page hidden">
    <div class="back-row" onclick="nav('home')">‚Üê Home</div>
    <div style="padding:0 16px 12px"><h2 style="font-size:20px">Settings</h2></div>
    <div class="card">
      <div class="card-header"><h3>Profile</h3></div>
      <div class="settings-row"><span class="settings-lbl">Name</span><span class="settings-val" id="settingsName">‚Äî</span></div>
      <div class="settings-row"><span class="settings-lbl">Email</span><span class="settings-val" id="settingsEmail">‚Äî</span></div>
    </div>
    <div class="card">
      <div class="card-header"><h3>Supabase</h3></div>
      <div class="card-body">
        <label class="field-label">Project URL</label><input type="text" id="settingsUrl" class="field-input" placeholder="https://xxx.supabase.co">
        <label class="field-label">Anon Key</label><input type="text" id="settingsKey" class="field-input" placeholder="eyJ‚Ä¶">
        <button class="btn-primary" onclick="Auth.saveConfig()">Save &amp; Reconnect</button>
        <div style="font-size:11px;color:var(--text-mut);margin-top:8px">Stored locally in this browser only.</div>
      </div>
    </div>
    <div class="card"><div class="card-body" style="text-align:center"><button class="btn-danger" onclick="Auth.signOut()" style="width:100%">Sign Out</button></div></div>
    <div style="text-align:center;padding:20px;color:var(--text-mut);font-size:12px">My Daily Reports v1.0.0<br>¬© Saltzman Inspections</div>
  </div>

</div>
<div class="bottom-nav">
  <div class="nav-item active" onclick="nav('home')"><span class="nav-icon">üèóÔ∏è</span>Jobs</div>
  <div class="nav-item" onclick="nav('settings')"><span class="nav-icon">‚öôÔ∏è</span>Settings</div>
</div>
</div>

<div class="toast" id="toast"></div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script src="js/state.js"></script>
<script src="js/auth.js"></script>
<script src="js/jobs.js"></script>
<script src="js/reports.js"></script>
<script src="js/schedule.js"></script>
<script>
  // Boot
  window.addEventListener('DOMContentLoaded', () => {
    const c = Config.get();
    if (c.url && c.key) Auth.initSupabase(c.url, c.key);
    else Auth.showLogin();
  });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#111111">
<title>My Daily Reports</title>
<link rel="manifest" href="manifest.json">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/app.css">
</head>
<body>

<!-- ========== AUTH VIEW ========== -->
<div id="authView" class="auth-screen">
  <div class="auth-logo">My Daily Reports</div>
  <div class="auth-sub">Construction Inspection Management</div>
  <div class="auth-card">
    <div class="auth-tabs">
      <div class="auth-tab active" onclick="showAuthTab('login')">Sign In</div>
      <div class="auth-tab" onclick="showAuthTab('signup')">Sign Up</div>
    </div>
    <button class="google-btn" onclick="signInWithGoogle()">
      <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
      Continue with Google
    </button>
    <div class="auth-divider">or</div>
    <div id="authLoginForm">
      <label class="field-label">Email</label>
      <input type="email" id="authEmail" class="field-input" placeholder="you@example.com">
      <label class="field-label">Password</label>
      <input type="password" id="authPassword" class="field-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <button class="btn-primary" onclick="signInWithEmail()" id="authSubmitBtn">Sign In</button>
    </div>
    <div id="authSignupForm" class="hidden">
      <label class="field-label">Full Name</label>
      <input type="text" id="signupName" class="field-input" placeholder="Your name">
      <label class="field-label">Email</label>
      <input type="email" id="signupEmail" class="field-input" placeholder="you@example.com">
      <label class="field-label">Password</label>
      <input type="password" id="signupPassword" class="field-input" placeholder="Min 6 characters">
      <button class="btn-primary" onclick="signUpWithEmail()">Create Account</button>
    </div>
    <div id="authError" style="color:var(--danger);font-size:13px;margin-top:12px;text-align:center;"></div>
  </div>
  <div style="margin-top:24px;text-align:center;">
    <button class="btn-secondary" onclick="showSetupModal()" style="font-size:12px;">Configure Supabase</button>
  </div>
</div>

<!-- ========== MAIN APP ========== -->
<div id="appView" class="hidden">
<div class="app-container">

  <!-- HEADER -->
  <div class="app-header">
    <div><div class="app-header-title">My Daily Reports</div><div class="app-header-sub" id="headerUserName"></div></div>
    <div class="app-header-right"><button class="header-btn" onclick="navigate('settings')">‚öôÔ∏è</button></div>
  </div>

  <!-- PAGE: HOME (Jobs List) -->
  <div id="page-home" class="page">
    <div style="padding:12px 16px;display:flex;align-items:center;justify-content:space-between;">
      <h2 style="font-size:20px;">Jobs</h2>
      <button class="btn-secondary" onclick="navigate('create-job')">+ New Job</button>
    </div>
    <div class="card" style="margin-top:0;"><div id="jobsList"></div></div>
    <div id="archivedSection" class="hidden" style="padding:0 16px;">
      <details class="collapsible-section" style="border-top:none;">
        <summary class="collapsible-summary">Archived Jobs</summary>
        <div id="archivedJobsList" class="card" style="margin:8px 0;"></div>
      </details>
    </div>
  </div>

  <!-- PAGE: CREATE/EDIT JOB -->
  <div id="page-create-job" class="page hidden">
    <div class="back-row" onclick="navigate('home')">‚Üê Jobs</div>
    <div class="card"><div class="card-header"><h3 id="jobFormTitle">New Job</h3></div>
    <div class="card-body">
      <input type="hidden" id="editJobId">
      <label class="field-label">Job Name *</label>
      <input type="text" id="jobName" class="field-input" placeholder="e.g., Woodland Park Middle School">
      <label class="field-label">Site Address</label>
      <input type="text" id="jobAddress" class="field-input" placeholder="123 Main St, City, CA">
      <label class="field-label">Hours Budget</label>
      <input type="number" id="jobHoursBudget" class="field-input" placeholder="Total inspection hours">
      <label class="field-label">Report Filename Pattern</label>
      <input type="text" id="jobFilenamePattern" class="field-input" placeholder="e.g., Report_%02d_%@.pdf">
      <label class="field-label">Export Destination</label>
      <input type="text" id="jobExportDest" class="field-input" placeholder="e.g., Google Drive folder">
      <label class="field-label">PDF Template Path</label>
      <input type="text" id="jobTemplatePath" class="field-input" placeholder="Path to PDF template">
      <button class="btn-primary" onclick="saveJob()" id="saveJobBtn">Create Job</button>
      <div id="deleteJobSection" class="hidden" style="margin-top:12px;">
        <button class="btn-danger" onclick="archiveJob()" style="width:100%;">Archive Job</button>
      </div>
    </div></div>
  </div>

  <!-- PAGE: JOB DETAIL -->
  <div id="page-job-detail" class="page hidden">
    <div class="back-row" onclick="navigate('home')">‚Üê Jobs</div>
    <div style="padding:0 16px 8px;display:flex;align-items:center;justify-content:space-between;">
      <div>
        <h2 id="jobDetailName" style="font-size:20px;"></h2>
        <div id="jobDetailAddress" style="font-size:13px;color:var(--text-sec);"></div>
      </div>
      <button class="btn-secondary" onclick="editCurrentJob()" style="font-size:11px;padding:6px 12px;">Edit</button>
    </div>
    <div class="tabs" id="jobTabBar">
      <div class="tab active" onclick="switchJobTab('reports')">Reports</div>
      <div class="tab" onclick="switchJobTab('schedule')">Schedule</div>
    </div>

    <!-- Reports Tab -->
    <div id="jobReportsTab">
      <div style="padding:12px 16px;display:flex;justify-content:flex-end;">
        <button class="btn-secondary" onclick="startNewReport()">+ New Report</button>
      </div>
      <div class="card" style="margin-top:0;"><div id="reportsList"></div></div>
    </div>

    <!-- Schedule Tab -->
    <div id="jobScheduleTab" class="hidden">
      <div class="tabs" style="margin:0 16px;">
        <div class="tab active" onclick="switchScheduleSubTab('calendar')">Calendar</div>
        <div class="tab" onclick="switchScheduleSubTab('request')">New Request</div>
      </div>

      <!-- Schedule Calendar -->
      <div id="scheduleCalendarView">
        <div class="card" style="border-radius:0;margin-top:0;">
          <div class="cal-nav">
            <button onclick="changeScheduleMonth(-1)">‚Üê</button>
            <strong id="schedMonthLabel"></strong>
            <button onclick="changeScheduleMonth(1)">‚Üí</button>
          </div>
          <div class="week-row" style="padding:0 8px;">
            <div class="week-header">S</div><div class="week-header">M</div><div class="week-header">T</div>
            <div class="week-header">W</div><div class="week-header">T</div><div class="week-header">F</div><div class="week-header">S</div>
          </div>
          <div id="schedCalGrid" class="week-row" style="padding:0 8px;"></div>
          <div class="day-detail" id="schedDayDetail">
            <div class="day-detail-header" id="schedDayDetailHeader"></div>
            <div id="schedDayDetailList"></div>
          </div>
        </div>
      </div>

      <!-- Schedule Request Form -->
      <div id="scheduleRequestView" class="hidden">
        <div class="card" style="margin-top:0;border-radius:0;">
          <div class="card-body">
            <label class="field-label">Photos or PDFs</label>
            <div class="photo-box" onclick="document.getElementById('schedFileInput').click()">üì∑ Tap to select multiple photos or PDFs</div>
            <input type="file" id="schedFileInput" onchange="handleScheduleFiles(this)" multiple style="display:none;" accept="image/*,application/pdf">
            <div id="schedFileGrid" class="file-list-container"></div>

            <label class="field-label">Inspection Date *</label>
            <input type="date" id="schedDate" class="field-input">

            <label class="field-label">Inspection Time *</label>
            <select id="schedTime" class="field-input">
              <option value="">Select time</option>
              <option value="flexible">Flexible ‚Äî anytime today</option>
              <option value="05:00">5:00 AM</option><option value="05:30">5:30 AM</option>
              <option value="06:00">6:00 AM</option><option value="06:30">6:30 AM</option>
              <option value="07:00">7:00 AM</option><option value="07:30">7:30 AM</option>
              <option value="08:00">8:00 AM</option><option value="08:30">8:30 AM</option>
              <option value="09:00">9:00 AM</option><option value="09:30">9:30 AM</option>
              <option value="10:00">10:00 AM</option><option value="10:30">10:30 AM</option>
              <option value="11:00">11:00 AM</option><option value="11:30">11:30 AM</option>
              <option value="12:00">12:00 PM</option><option value="12:30">12:30 PM</option>
              <option value="13:00">1:00 PM</option><option value="13:30">1:30 PM</option>
              <option value="14:00">2:00 PM</option><option value="14:30">2:30 PM</option>
              <option value="15:00">3:00 PM</option><option value="15:30">3:30 PM</option>
              <option value="16:00">4:00 PM</option><option value="16:30">4:30 PM</option>
              <option value="17:00">5:00 PM</option>
            </select>

            <label class="field-label">Inspection Request # or Summary</label>
            <input type="text" id="schedIdentifier" class="field-input" placeholder="e.g., FDN-003, SLAB-B2" maxlength="50">

            <label class="field-label">Duration *</label>
            <div class="dur-btns" id="schedDurBtns">
              <div class="dur-btn" onclick="setScheduleDur('30',this)">30 min</div>
              <div class="dur-btn" onclick="setScheduleDur('60',this)">1 hr</div>
              <div class="dur-btn" onclick="setScheduleDur('120',this)">2 hr</div>
              <div class="dur-btn" onclick="setScheduleDur('240',this)">4 hr</div>
              <div class="dur-btn" onclick="setScheduleDur('480',this)">All Day</div>
            </div>

            <label class="field-label">Inspection Type *</label>
            <div class="type-btns">
              <div class="type-btn" onclick="setScheduleType('Special',this)">Special</div>
              <div class="type-btn" onclick="setScheduleType('IOR',this)">IOR</div>
            </div>
            <div class="special-sub" id="schedSpecialSub">
              <label class="field-label">Special Inspection Type *</label>
              <select class="field-input" id="schedSpecialType">
                <option value="">Select type</option>
                <option value="Soils">Soils</option><option value="Material ID">Material ID</option>
                <option value="Material ID CWI">Material ID CWI</option><option value="Concrete">Concrete</option>
                <option value="Bolting">Bolting</option><option value="Pull Test">Pull Test</option>
                <option value="Shotcrete">Shotcrete</option><option value="Fireproofing">Fireproofing</option>
              </select>
            </div>

            <label class="field-label">Submitted By *</label>
            <select id="schedSubmittedBy" class="field-input">
              <option value="">Select your name</option>
              <option value="other">-- Add name below --</option>
            </select>

            <label class="field-label">Notes</label>
            <textarea id="schedNotes" class="field-input" rows="3" placeholder="Optional details"></textarea>

            <label class="field-label">Send a copy to:</label>
            <div class="email-list" id="schedEmailList"><div style="color:var(--text-mut);font-size:12px;padding:4px 0;">Configure team emails in job settings</div></div>

            <details class="collapsible-section">
              <summary class="collapsible-summary">Additional Email Recipients</summary>
              <div style="padding-bottom:10px;">
                <input type="text" id="schedAdditionalEmails" class="field-input" placeholder="Emails separated by commas">
              </div>
            </details>

            <details class="collapsible-section">
              <summary class="collapsible-summary">Add a New Person to Dropdown</summary>
              <div style="padding:16px;background:#2a2a2a;border-radius:8px;border-left:4px solid var(--blue);">
                <div style="color:var(--blue);font-weight:600;margin-bottom:8px;">Don't see your name? Add it below:</div>
                <label class="field-label">Your Name</label>
                <input type="text" id="schedNewName" class="field-input">
                <label class="field-label">Your Email</label>
                <input type="email" id="schedNewEmail" class="field-input">
                <label class="field-label">Company/Role</label>
                <input type="text" id="schedNewCompany" class="field-input" placeholder="e.g., (CW Driver)">
              </div>
            </details>

            <button class="btn-primary" onclick="submitScheduleRequest()" id="schedSubmitBtn">Submit Inspection Request</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PAGE: CREATE/EDIT REPORT -->
  <div id="page-create-report" class="page hidden">
    <div class="back-row" onclick="backFromReport()">‚Üê Back</div>
    <div style="padding:0 16px 8px;">
      <h2 id="reportFormTitle" style="font-size:18px;">New Report</h2>
      <div id="reportFormJobName" style="font-size:13px;color:var(--text-sec);"></div>
    </div>
    <div class="card" style="margin-top:0;">
      <div class="form-section">
        <div class="form-section-title">Report Info</div>
        <input type="hidden" id="reportId"><input type="hidden" id="reportJobId">
        <label class="field-label">Date *</label>
        <input type="date" id="reportDate" class="field-input">
        <label class="field-label">Report Number</label>
        <input type="number" id="reportNumber" class="field-input" value="1" min="1">
      </div>
      <div class="form-section">
        <div class="form-section-title">Project Information</div>
        <label class="field-label">Project Name</label><input type="text" id="reportProjectName" class="field-input">
        <label class="field-label">TYR Project #</label><input type="text" id="reportProjectNumber" class="field-input">
        <label class="field-label">District Name</label><input type="text" id="reportJurisdiction" class="field-input">
        <label class="field-label">DSA Number</label><input type="text" id="reportDsaFileNumber" class="field-input">
        <label class="field-label">Project Address</label><input type="text" id="reportProjectAddress" class="field-input">
        <label class="field-label">Weather</label><input type="text" id="reportWeather" class="field-input">
      </div>
      <div class="form-section">
        <div class="form-section-title">Hours Tracking</div>
        <label class="field-label">Regular Hours</label><input type="text" id="reportRegularHours" class="field-input">
        <label class="field-label">Overtime Hours</label><input type="text" id="reportOvertimeHours" class="field-input">
        <label class="field-label">Double Time Hours</label><input type="text" id="reportDoubleTimeHours" class="field-input">
      </div>
      <div class="form-section">
        <div class="form-section-title">Team Information</div>
        <label class="field-label">Inspector Name (IOR)</label><input type="text" id="reportIorName" class="field-input">
        <label class="field-label">Project Manager</label><input type="text" id="reportProjectManager" class="field-input">
        <label class="field-label">Architect</label><input type="text" id="reportArchitect" class="field-input">
        <label class="field-label">Contractor Names</label><input type="text" id="reportContractor" class="field-input">
      </div>
      <div class="form-section">
        <div class="form-section-title">Contractor Activity</div>
        <label class="field-label">Manpower</label><textarea id="reportManpower" class="field-input" rows="2"></textarea>
        <label class="field-label">Equipment</label><textarea id="reportEquipment" class="field-input" rows="2"></textarea>
        <label class="field-label">Trade</label><input type="text" id="reportTrade" class="field-input">
      </div>
      <div class="form-section">
        <div class="form-section-title">Inspection Content</div>
        <label class="field-label">General Notes</label><textarea id="reportGeneralNotes" class="field-input" rows="4"></textarea>
        <label class="field-label">Inspection and Onsite Activities</label><textarea id="reportInspectionActivities" class="field-input" rows="4"></textarea>
        <label class="field-label">Corrections</label><textarea id="reportCorrections" class="field-input" rows="3"></textarea>
        <label class="field-label">Observation Letters Issued</label><textarea id="reportObservationLetters" class="field-input" rows="2"></textarea>
        <label class="field-label">Notes and Comments</label><textarea id="reportIorNotes" class="field-input" rows="3"></textarea>
      </div>
      <div class="form-section">
        <div class="form-section-title">Inspection Requests</div>
        <label class="field-label">RFIs</label><textarea id="reportRfis" class="field-input" rows="2"></textarea>
        <label class="field-label">Submittals</label><textarea id="reportSubmittals" class="field-input" rows="2"></textarea>
        <label class="field-label">CCDs</label><textarea id="reportCcds" class="field-input" rows="2"></textarea>
        <label class="field-label">ASIs</label><textarea id="reportAsis" class="field-input" rows="2"></textarea>
        <label class="field-label">Site Visits</label><textarea id="reportSiteVisits" class="field-input" rows="2"></textarea>
      </div>
      <div class="form-section">
        <div class="form-section-title">Site Photos</div>
        <div class="photo-box" onclick="document.getElementById('reportPhotoInput').click()">üì∑ Tap to add site photos</div>
        <input type="file" id="reportPhotoInput" onchange="handleReportPhotos(this)" multiple accept="image/*" style="display:none;">
        <div id="reportPhotoGrid" class="file-list-container"></div>
      </div>
      <div class="form-section" style="display:flex;gap:10px;flex-direction:column;">
        <button class="btn-primary" onclick="saveReportDraft()">Save Draft</button>
        <button class="btn-primary" onclick="submitReport()" style="background:var(--success);">Submit Report</button>
        <div id="deleteReportSection" class="hidden">
          <button class="btn-danger" onclick="deleteCurrentReport()" style="width:100%;">Delete Report</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PAGE: VIEW REPORT -->
  <div id="page-view-report" class="page hidden">
    <div class="back-row" onclick="backFromReport()">‚Üê Back</div>
    <div id="viewReportContent"></div>
  </div>

  <!-- PAGE: SETTINGS -->
  <div id="page-settings" class="page hidden">
    <div class="back-row" onclick="navigate('home')">‚Üê Home</div>
    <div style="padding:0 16px 12px;"><h2 style="font-size:20px;">Settings</h2></div>
    <div class="card">
      <div class="card-header"><h3>Profile</h3></div>
      <div class="settings-item"><span class="settings-label">Name</span><span class="settings-value" id="settingsName">‚Äî</span></div>
      <div class="settings-item"><span class="settings-label">Email</span><span class="settings-value" id="settingsEmail">‚Äî</span></div>
    </div>
    <div class="card">
      <div class="card-header"><h3>Supabase Configuration</h3></div>
      <div class="card-body">
        <label class="field-label">Supabase URL</label>
        <input type="text" id="settingsSupabaseUrl" class="field-input" placeholder="https://your-project.supabase.co">
        <label class="field-label">Supabase Anon Key</label>
        <input type="text" id="settingsSupabaseKey" class="field-input" placeholder="eyJ...">
        <button class="btn-primary" onclick="saveSupabaseConfig()">Save & Reconnect</button>
        <div style="font-size:11px;color:var(--text-mut);margin-top:8px;">Stored locally in this browser only.</div>
      </div>
    </div>
    <div class="card"><div class="card-body" style="text-align:center;">
      <button class="btn-danger" onclick="signOut()" style="width:100%;">Sign Out</button>
    </div></div>
    <div style="text-align:center;padding:20px;color:var(--text-mut);font-size:12px;">My Daily Reports v1.0.0<br>¬© Saltzman Inspections</div>
  </div>

</div><!-- app-container -->

<!-- BOTTOM NAV -->
<div class="bottom-nav">
  <div class="nav-item active" onclick="navigate('home')"><span class="nav-icon">üèóÔ∏è</span>Jobs</div>
  <div class="nav-item" onclick="navigate('settings')"><span class="nav-icon">‚öôÔ∏è</span>Settings</div>
</div>
</div><!-- appView -->

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script src="js/utils.js"></script>
<script src="js/auth.js"></script>
<script src="js/jobs.js"></script>
<script src="js/reports.js"></script>
<script src="js/schedule.js"></script>
<script src="js/app.js"></script>
</body>
</html>
